<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Clients - Shopina</title>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { 
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Inter', sans-serif; 
      background: #f8f9fa; 
      color: #0A1A2F; 
      line-height: 1.5;
    }
    
    /* ========== NAVBAR ========== */
    .navbar { 
      background: white; 
      border-bottom: 1px solid #e0e0e0; 
      padding: 16px 24px; 
      position: sticky; 
      top: 0; 
      z-index: 100;
      box-shadow: 0 2px 8px rgba(0,0,0,0.04);
    }
    .navbar-content { 
      max-width: 1400px; 
      margin: 0 auto; 
      display: flex; 
      justify-content: space-between; 
      align-items: center; 
    }
    .navbar-brand { 
      font-size: 22px; 
      font-weight: 800; 
      background: linear-gradient(135deg, #0077FF 0%, #5AC8FA 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      text-decoration: none;
      letter-spacing: -0.5px;
    }
    
    /* ========== PROFILE MENU ========== */
    .navbar-menu { display:flex; align-items:center; gap:10px; }
    .navbar-menu-button { 
      display:inline-flex; 
      align-items:center; 
      gap:8px; 
      padding:10px 16px; 
      border-radius:10px; 
      background: rgba(0,119,255,0.1); 
      border:1px solid rgba(0,119,255,0.2); 
      color:#0A1A2F; 
      text-decoration:none; 
      cursor:pointer; 
      font-weight:600; 
      font-size:13px; 
      transition:all 200ms ease;
    }
    .navbar-menu-button:hover { 
      background: rgba(0,119,255,0.2); 
      border-color: rgba(0,119,255,0.4); 
      transform: translateY(-1px); 
    }
    .navbar-menu-button.home { 
      background: linear-gradient(135deg, #0077FF 0%, #5AC8FA 100%); 
      border-color: #0077FF; 
      color:#fff; 
      box-shadow: 0 2px 8px rgba(0,119,255,0.2);
    }
    .navbar-menu-button.home:hover { 
      transform: translateY(-2px); 
      box-shadow: 0 4px 12px rgba(0,119,255,0.3); 
    }
    
    .profile-section { position:relative; display:flex; align-items:center; gap:10px; }
    .profile-trigger { 
      display:flex; 
      align-items:center; 
      gap:10px; 
      padding:8px 12px; 
      border-radius:12px; 
      border:1px solid transparent; 
      background: transparent; 
      cursor:pointer; 
      transition: all 200ms ease;
    }
    .profile-trigger:hover { 
      border-color:#e0e0e0; 
      background:#f8fafc; 
    }
    .profile-trigger:focus-visible { 
      outline:2px solid rgba(0,119,255,0.5); 
      outline-offset:2px; 
    }
    .profile-avatar { 
      width:40px; 
      height:40px; 
      border-radius:50%; 
      background: linear-gradient(135deg, #0077FF 0%, #5AC8FA 100%); 
      display:flex; 
      align-items:center; 
      justify-content:center; 
      font-weight:800; 
      color:#fff;
      font-size: 16px;
      box-shadow: 0 2px 8px rgba(0,119,255,0.2);
    }
    .profile-avatar img { 
      width:100%; 
      height:100%; 
      border-radius:50%; 
      object-fit:cover; 
    }
    .profile-info { text-align:left; line-height:1.3; }
    .profile-name { margin:0; font-size:14px; font-weight:700; color:#0A1A2F; }
    .profile-role { margin:2px 0 0; font-size:12px; font-weight:600; color:#0077FF; }
    .profile-chevron { font-size:14px; color:#64748b; transition: transform 200ms; }
    .profile-trigger[aria-expanded="true"] .profile-chevron { transform: rotate(180deg); }
    
    .profile-menu { 
      position:absolute; 
      right:0; 
      top:calc(100% + 10px); 
      min-width: 240px; 
      background:#fff; 
      border:1px solid #e2e8f0; 
      border-radius:12px; 
      box-shadow: 0 20px 60px rgba(0,0,0,0.12); 
      padding:8px; 
      display:none; 
      flex-direction:column; 
      gap:4px; 
      z-index:50;
    }
    .profile-menu.open { display:flex; animation: fadeDown 200ms ease; }
    .profile-menu a { 
      display:flex; 
      align-items:center; 
      gap:12px; 
      padding:12px 14px; 
      border-radius:10px; 
      color:#0A1A2F; 
      text-decoration:none; 
      font-weight:600; 
      font-size: 14px;
      transition: all 180ms ease;
    }
    .profile-menu a:hover, .profile-menu a:focus-visible { 
      background: #f1f5f9; 
      color:#0077FF;
      outline:none; 
    }
    .profile-menu .danger { color:#ef4444; }
    .profile-menu .danger:hover, .profile-menu .danger:focus-visible { 
      background: rgba(239,68,68,0.1); 
      color:#dc2626;
    }
    
    @keyframes fadeDown { 
      from { opacity:0; transform: translateY(-8px); } 
      to { opacity:1; transform: translateY(0); } 
    }
    
    /* ========== CONTAINER ========== */
    .container { 
      max-width: 1400px; 
      margin: 0 auto; 
      padding: 32px 24px; 
    }
    
    /* ========== BREADCRUMB ========== */
    .breadcrumb { 
      display:flex; 
      align-items:center; 
      gap:8px; 
      padding:0 0 20px; 
      margin-bottom:24px; 
      font-size:14px; 
      color:#64748b; 
      border-bottom:1px solid #e2e8f0; 
    }
    .breadcrumb a { 
      color:#0077FF; 
      text-decoration:none; 
      transition:all 200ms ease;
      font-weight: 500;
    }
    .breadcrumb a:hover { 
      color:#5AC8FA; 
      text-decoration:underline; 
    }
    .breadcrumb-separator { color:#cbd5e1; margin:0 4px; }
    .breadcrumb-current { color:#0A1A2F; font-weight:700; }
    
    /* ========== HEADER ========== */
    .header { 
      display:flex; 
      justify-content: space-between; 
      align-items: center; 
      margin-bottom: 24px;
      flex-wrap: wrap;
      gap: 16px;
    }
    .title { 
      font-size: 32px; 
      font-weight: 800;
      color: #0A1A2F;
      display: flex;
      align-items: center;
      gap: 12px;
    }
    
    /* ========== SEARCH ========== */
    .search { 
      display:flex; 
      gap:10px; 
      align-items: center;
    }
    input[type="search"] { 
      padding: 12px 16px; 
      border: 2px solid #e2e8f0; 
      border-radius: 12px; 
      width: 320px;
      font-size: 14px;
      transition: all 200ms ease;
      background: white;
    }
    input[type="search"]:focus { 
      outline:none; 
      border-color:#0077FF; 
      box-shadow: 0 0 0 4px rgba(0,119,255,.08); 
    }
    input[type="search"]::placeholder {
      color: #94a3b8;
    }
    
    /* ========== BUTTONS ========== */
    .btn { 
      display:inline-flex;
      align-items: center;
      gap: 8px;
      padding:12px 20px; 
      border-radius: 12px; 
      text-decoration:none; 
      font-weight:600;
      font-size: 14px;
      transition:all 200ms ease;
      cursor: pointer;
      border: none;
    }
    .btn-secondary { 
      background:#f1f5f9; 
      color:#0A1A2F;
      border: 1px solid #e2e8f0;
    }
    .btn-secondary:hover { 
      background:#e2e8f0;
      border-color: #cbd5e1;
      transform: translateY(-1px);
    }
    .btn-primary {
      background: linear-gradient(135deg, #0077FF 0%, #5AC8FA 100%);
      color: #fff;
      box-shadow: 0 4px 12px rgba(0,119,255,0.25);
      border: none;
    }
    .btn-primary:hover { 
      transform: translateY(-2px); 
      box-shadow: 0 8px 24px rgba(0,119,255,0.35); 
    }
    .btn-primary:active { 
      transform: translateY(0); 
    }
    .btn:focus-visible { 
      outline: 2px solid rgba(90,200,250,0.6); 
      outline-offset: 2px; 
    }
    
    /* ========== ACTIONS ========== */
    .actions {
      display:flex; 
      gap:12px; 
      margin-bottom:24px;
      flex-wrap: wrap;
    }
    
    /* ========== STATS ========== */
    .stats { 
      display:grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap:16px; 
      margin-bottom: 24px; 
    }
    .stat { 
      background: white; 
      border: 1px solid #e2e8f0; 
      padding: 20px 24px; 
      border-radius: 16px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.04);
      transition: all 200ms ease;
    }
    .stat:hover {
      box-shadow: 0 4px 16px rgba(0,0,0,0.08);
      transform: translateY(-2px);
    }
    .stat-label {
      font-size: 13px;
      font-weight: 600;
      color: #64748b;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-bottom: 8px;
    }
    .stat-value {
      font-size: 28px;
      font-weight: 800;
      color: #0A1A2F;
    }
    
    /* ========== CARD ========== */
    .card { 
      background: white; 
      border-radius: 16px; 
      box-shadow: 0 2px 8px rgba(0,0,0,.04);
      border: 1px solid #e2e8f0;
      overflow: hidden;
    }
    
    /* ========== TABLE ========== */
    .table-wrapper {
      overflow-x: auto;
    }
    table { 
      width: 100%; 
      border-collapse: collapse;
    }
    thead {
      background: #f8fafc;
      border-bottom: 2px solid #e2e8f0;
    }
    th { 
      text-align: left; 
      padding: 16px 20px; 
      font-weight: 700; 
      color: #475569;
      font-size: 13px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    td { 
      text-align: left; 
      padding: 16px 20px; 
      border-bottom: 1px solid #f1f5f9;
      font-size: 14px;
    }
    tbody tr { 
      transition: all 150ms ease;
      cursor: pointer;
    }
    tbody tr:hover { 
      background: #f8fafc;
    }
    tbody tr:active {
      background: #f1f5f9;
    }
    
    /* ========== CLIENT AVATAR ========== */
    .client-avatar-cell {
      display: flex;
      align-items: center;
      gap: 12px;
    }
    .client-avatar { 
      width:44px; 
      height:44px; 
      border-radius:50%; 
      background: linear-gradient(135deg, #0077FF 0%, #5AC8FA 100%); 
      display:flex; 
      align-items:center; 
      justify-content:center; 
      font-weight:700; 
      color:#fff;
      font-size: 16px;
      flex-shrink: 0;
      box-shadow: 0 2px 8px rgba(0,119,255,0.2);
    }
    .client-avatar img { 
      width:100%; 
      height:100%; 
      border-radius:50%; 
      object-fit:cover; 
    }
    .client-info {
      display: flex;
      flex-direction: column;
      gap: 2px;
    }
    .client-name {
      font-weight: 700;
      color: #0A1A2F;
      font-size: 15px;
    }
    .client-username {
      font-size: 13px;
      color: #64748b;
      font-weight: 500;
    }
    
    /* ========== BADGES ========== */
    .badge { 
      display:inline-block; 
      padding:6px 12px; 
      border-radius: 8px; 
      font-size:12px; 
      font-weight:700;
      text-transform: uppercase;
      letter-spacing: 0.3px;
    }
    .badge-free { background:#f1f5f9; color:#64748b; }
    .badge-starter { background:#dbeafe; color:#0077FF; }
    .badge-pro { background:#dcfce7; color:#16a34a; }
    .badge-enterprise { background:#fef3c7; color:#d97706; }
    
    /* ========== EMPTY STATE ========== */
    .empty { 
      text-align:center; 
      padding:60px 24px; 
      color:#64748b;
    }
    .empty-icon {
      font-size: 64px;
      margin-bottom: 16px;
      opacity: 0.5;
    }
    .empty-title {
      font-size: 20px;
      font-weight: 700;
      color: #0A1A2F;
      margin-bottom: 8px;
    }
    .empty-text {
      font-size: 15px;
      color: #64748b;
    }
    
    /* ========== RESPONSIVE ========== */
    @media (max-width: 768px) {
      .container { padding: 20px 16px; }
      .header { flex-direction: column; align-items: stretch; }
      .title { font-size: 24px; }
      input[type="search"] { width: 100%; }
      .actions { flex-direction: column; }
      .btn { width: 100%; justify-content: center; }
      .stats { grid-template-columns: 1fr; }
      th, td { padding: 12px 16px; font-size: 13px; }
      .navbar-content { flex-direction: column; gap: 12px; }
      .navbar-menu { width: 100%; justify-content: center; }
    }
  </style>
</head>
<body>
  <!-- Profile Menu Script -->
  <script>
    (function() {
      const containers = document.querySelectorAll('[data-profile-menu]');
      containers.forEach(container => {
        const trigger = container.querySelector('.profile-trigger');
        const menu = container.querySelector('.profile-menu');
        if (!trigger || !menu) return;
        const items = Array.from(menu.querySelectorAll('[role="menuitem"]'));
        const close = () => { menu.classList.remove('open'); trigger.setAttribute('aria-expanded','false'); };
        const open = () => { menu.classList.add('open'); trigger.setAttribute('aria-expanded','true'); };
        const toggle = () => menu.classList.contains('open') ? close() : open();
        trigger.addEventListener('click', (e) => { e.stopPropagation(); toggle(); if (menu.classList.contains('open') && items.length) items[0].focus(); });
        trigger.addEventListener('keydown', (e) => {
          if (['Enter',' ','ArrowDown'].includes(e.key)) { e.preventDefault(); open(); if (items.length) items[0].focus(); }
        });
        menu.addEventListener('keydown', (e) => {
          if (e.key === 'Escape') { close(); trigger.focus(); }
          if (['ArrowDown','ArrowUp'].includes(e.key)) {
            e.preventDefault();
            const current = items.indexOf(document.activeElement);
            const dir = e.key === 'ArrowDown' ? 1 : -1;
            const next = (current + dir + items.length) % items.length;
            items[next]?.focus();
          }
        });
        document.addEventListener('click', (e) => { if (!container.contains(e.target)) close(); });
      });
    })();
  </script>
  <!-- Profile Menu Script -->
  <script>
    (function() {
      const containers = document.querySelectorAll('[data-profile-menu]');
      containers.forEach(container => {
        const trigger = container.querySelector('.profile-trigger');
        const menu = container.querySelector('.profile-menu');
        if (!trigger || !menu) return;
        const items = Array.from(menu.querySelectorAll('[role="menuitem"]'));
        const close = () => { menu.classList.remove('open'); trigger.setAttribute('aria-expanded','false'); };
        const open = () => { menu.classList.add('open'); trigger.setAttribute('aria-expanded','true'); };
        const toggle = () => menu.classList.contains('open') ? close() : open();
        trigger.addEventListener('click', (e) => { e.stopPropagation(); toggle(); if (menu.classList.contains('open') && items.length) items[0].focus(); });
        trigger.addEventListener('keydown', (e) => {
          if (['Enter',' ','ArrowDown'].includes(e.key)) { e.preventDefault(); open(); if (items.length) items[0].focus(); }
        });
        menu.addEventListener('keydown', (e) => {
          if (e.key === 'Escape') { close(); trigger.focus(); }
          if (['ArrowDown','ArrowUp'].includes(e.key)) {
            e.preventDefault();
            const current = items.indexOf(document.activeElement);
            const dir = e.key === 'ArrowDown' ? 1 : -1;
            const next = (current + dir + items.length) % items.length;
            items[next]?.focus();
          }
        });
        document.addEventListener('click', (e) => { if (!container.contains(e.target)) close(); });
      });
    })();
  </script>

  <!-- Navbar -->
  <div class="navbar">
    <div class="navbar-content">
      <a href="{% url 'dashboard' %}" class="navbar-brand">Shopina</a>
      <div style="display:flex; align-items:center; gap:16px;">
        <div class="navbar-menu">
          <a href="{% url 'home' %}" class="navbar-menu-button" title="Page d'accueil publique">üè† Accueil</a>
          <a href="/dashboard/" class="navbar-menu-button home" title="Tableau de bord">üìä Dashboard</a>
        </div>
        <div class="profile-section" data-profile-menu>
          <button class="profile-trigger" type="button" aria-haspopup="menu" aria-expanded="false">
            <span class="profile-avatar">
              {% if request.user.is_authenticated and request.user.avatar %}
                <img src="{{ request.user.avatar.url }}" alt="Avatar de {{ request.user.get_full_name|default:request.user.username }}" />
              {% else %}
                {% if request.user.is_authenticated %}
                  {{ request.user.username|first|upper }}
                {% else %}
                  ?
                {% endif %}
              {% endif %}
            </span>
            <span class="profile-info">
              {% if request.user.is_authenticated %}
                <span class="profile-name">{{ request.user.get_full_name|default:request.user.username }}</span>
                <span class="profile-role">{% if request.user.is_superuser %}Propri√©taire{% elif request.user.is_staff %}Admin{% else %}Utilisateur{% endif %}</span>
              {% else %}
                <span class="profile-name">Invit√©</span>
                <span class="profile-role">Non connect√©</span>
              {% endif %}
            </span>
            <span class="profile-chevron" aria-hidden="true">‚ñæ</span>
          </button>
          <div class="profile-menu" role="menu">
            <a href="{% url 'profile_dynamic' %}" role="menuitem">üë§ Mon Profil</a>
            <a href="/accounts/password_change/" role="menuitem">üîê Changer mot de passe</a>
            <a href="{% url 'home' %}" role="menuitem">üëÅÔ∏è Vue visiteur</a>
            <a href="{% url 'orders-page' %}" role="menuitem">üì¶ Mes Commandes</a>
            <a href="/accounts/logout/" role="menuitem" class="danger">üö™ D√©connexion</a>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Main Container -->
  <div class="container">
    <!-- Breadcrumb -->
    <nav class="breadcrumb" aria-label="Fil d'Ariane">
      <a href="/dashboard/">üìä Tableau de bord</a>
      <span class="breadcrumb-separator">/</span>
      <span class="breadcrumb-current">üë• Clients</span>
    </nav>

    <!-- Header -->
    <div class="header">
      <div class="title">
        üë• Clients
      </div>
      <form method="get" class="search">
        <input type="search" name="q" value="{{ query }}" placeholder="Rechercher par nom, email..." aria-label="Rechercher un client" />
        <button class="btn btn-secondary" type="submit">üîç Rechercher</button>
      </form>
    </div>

    <!-- Actions -->
    <div class="actions">
      <button class="btn btn-secondary" type="button" onclick="history.back()">‚Üê Retour</button>
      <a class="btn btn-primary" href="/dashboard/">üìä Tableau de bord</a>
    </div>

    <!-- Stats -->
    <div class="stats">
      <div class="stat">
        <div class="stat-label">Total Clients</div>
        <div class="stat-value">{{ stats.total }}</div>
      </div>
      <div class="stat">
        <div class="stat-label">Clients Actifs</div>
        <div class="stat-value">{{ stats.active }}</div>
      </div>
      <div class="stat">
        <div class="stat-label">Taux d'activit√©</div>
        <div class="stat-value">{% if stats.total > 0 %}{{ stats.active|floatformat:0|add:"0"|mul:100|div:stats.total|floatformat:0 }}%{% else %}0%{% endif %}</div>
      </div>
    </div>

    <!-- Clients Table -->
    <div class="card">
      {% if clients %}
        <div class="table-wrapper">
          <table>
            <thead>
              <tr>
                <th>Client</th>
                <th>Email</th>
                <th>T√©l√©phone</th>
                <th>Plan</th>
                <th>Inscription</th>
                <th>Commandes</th>
              </tr>
            </thead>
            <tbody id="rows">
              {% for c in clients %}
                <tr onclick="window.location.href='/admin/users/user/{{ c.id }}/change/'" title="Cliquer pour voir les d√©tails">
                  <td>
                    <div class="client-avatar-cell">
                      <div class="client-avatar">
                        {% if c.avatar_url %}
                          <img src="{{ c.avatar_url }}" alt="Avatar de {{ c.name }}" />
                        {% else %}
                          {{ c.name|first|upper }}
                        {% endif %}
                      </div>
                      <div class="client-info">
                        <div class="client-name">{{ c.name }}</div>
                        <div class="client-username">@{{ c.username }}</div>
                      </div>
                    </div>
                  </td>
                  <td>{{ c.email }}</td>
                  <td>{{ c.phone|default:"‚Äî" }}</td>
                  <td>
                    <span class="badge badge-{{ c.plan|lower }}">{{ c.plan|upper }}</span>
                  </td>
                  <td>{{ c.joined|date:"d/m/Y" }}</td>
                  <td><strong>{{ c.orders_count }}</strong></td>
                </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      {% else %}
        <div class="empty">
          <div class="empty-icon">üë•</div>
          <div class="empty-title">Aucun client trouv√©</div>
          <div class="empty-text">
            {% if query %}
              Aucun r√©sultat pour "{{ query }}". Essayez une autre recherche.
            {% else %}
              Il n'y a pas encore de clients enregistr√©s.
            {% endif %}
          </div>
        </div>
      {% endif %}
    </div>
  </div>

  <!-- Client-side search enhancement -->
  <script>
    const input = document.querySelector('input[type="search"]');
    const rows = document.getElementById('rows');
    if (input && rows) {
      // Real-time search filtering
      input.addEventListener('input', () => {
        const q = input.value.toLowerCase();
        rows.querySelectorAll('tr').forEach(tr => {
          const txt = tr.innerText.toLowerCase();
          tr.style.display = txt.includes(q) ? '' : 'none';
        });
      });
    }

    // Row click feedback
    if (rows) {
      rows.querySelectorAll('tr').forEach(tr => {
        tr.style.cursor = 'pointer';
      });
    }
  </script>
</body>
</html>
